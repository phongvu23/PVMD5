<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>MD5 Káº¿t Quáº£ Ngáº«u NhiÃªn</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 40px; background: #f2f2f2; }
        h1 { color: #333; }
        input, button { padding: 10px; font-size: 16px; }
        #result, #registerResult, #loginResult, #error { margin-top: 20px; font-weight: bold; }
        #result { color: green; }
        #error { color: red; }
        #adminSection { display: none; margin-top: 20px; }
        #userInfo { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>ğŸ” Nháº­p chuá»—i MD5 Ä‘á»ƒ táº¡o káº¿t quáº£</h1>
    
    <!-- ThÃ´ng tin ngÆ°á»i dÃ¹ng -->
    <div id="userInfo"></div>

    <input type="text" id="md5Input" placeholder="VD: c6a4afdb6725166ff1b5845c5546830d" size="40">
    <button onclick="handleGenerate()">Táº¡o káº¿t quáº£</button>
    <div id="result"></div>
    <div id="error"></div>

    <h2>ÄÄƒng KÃ½</h2>
    <input type="text" id="registerUsername" placeholder="TÃªn Ä‘Äƒng nháº­p" size="40">
    <input type="password" id="registerPassword" placeholder="Máº­t kháº©u" size="40">
    <button onclick="handleRegister()">ÄÄƒng KÃ½</button>
    <div id="registerResult"></div>

    <h2>ÄÄƒng Nháº­p</h2>
    <input type="text" id="loginUsername" placeholder="TÃªn Ä‘Äƒng nháº­p" size="40">
    <input type="password" id="loginPassword" placeholder="Máº­t kháº©u" size="40">
    <button onclick="handleLogin()">ÄÄƒng Nháº­p</button>
    <div id="loginResult"></div>
    <button onclick="handleLogout()" id="logoutButton" style="display:none;">ÄÄƒng Xuáº¥t</button>

    <div id="adminSection">
        <h2>Quáº£n LÃ½ Äiá»ƒm</h2>
        <input type="text" id="adminUsername" placeholder="TÃªn Ä‘Äƒng nháº­p ngÆ°á»i dÃ¹ng" size="40">
        <input type="number" id="pointsToAdd" placeholder="Sá»‘ Ä‘iá»ƒm cáº§n cá»™ng" size="10">
        <button onclick="handleAddPoints()">Cá»™ng Ä‘iá»ƒm</button>
        <div id="adminResult"></div>
    </div>

    <script>
        let users = [];
        let currentUser = null;

        // Táº¡o tÃ i khoáº£n admin máº·c Ä‘á»‹nh
        const adminAccount = { username: "phongvu", password: "123adm", points: 0, isAdmin: true };

        function generateRandomResult(md5Hash) {
            if (typeof md5Hash !== 'string' || md5Hash.length !== 32 || !/^[0-9a-f]{32}$/i.test(md5Hash)) {
                throw new Error("MÃ£ MD5 khÃ´ng há»£p lá»‡. Vui lÃ²ng nháº­p chuá»—i MD5 gá»“m 32 kÃ½ tá»± hexa.");
            }

            let number = BigInt('0x' + md5Hash);
            let num1 = Number((number % 6n) + 1n);
            number = (number * 3n + 7n) % 10000000000n;
            let num2 = Number((number % 6n) + 1n);
            number = ((number - 5n) * 2n) % 10000000000n;
            let num3 = Number((number % 6n) + 1n);

            const mapping = { 1: '3', 2: '2', 3: '1', 4: '5', 5: '6', 6: '4' };

            let mappedNum1 = mapping[num1];
            let mappedNum2 = mapping[num2];
            let mappedNum3 = mapping[num3];

            const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+-=[]{}|;:',.<>/?";
            let randomStr = "";
            for (let i = 0; i < 30; i++) {
                randomStr += chars.charAt(Math.floor(Math.random() * chars.length));
            }

            return `${mappedNum1}-${mappedNum2}-${mappedNum3}|${randomStr}`;
        }

        function updateUserInfo() {
            const userInfoDiv = document.getElementById('userInfo');
            if (currentUser) {
                userInfoDiv.innerHTML = `ğŸ‘¤ TÃªn ngÆ°á»i dÃ¹ng: ${currentUser.username} | Äiá»ƒm cÃ²n láº¡i: ${currentUser.points}`;
            } else {
                userInfoDiv.innerHTML = '';
            }
        }

        function handleGenerate() {
            const md5 = document.getElementById('md5Input').value.trim();
            const resultDiv = document.getElementById('result');
            const errorDiv = document.getElementById('error');
            resultDiv.innerText = '';
            errorDiv.innerText = '';

            if (!currentUser) {
                errorDiv.innerText = "âŒ Báº¡n cáº§n Ä‘Äƒng nháº­p Ä‘á»ƒ táº¡o káº¿t quáº£.";
                return;
            }

            if (currentUser.points < 1000) {
                errorDiv.innerText = "âŒ Báº¡n khÃ´ng Ä‘á»§ Ä‘iá»ƒm Ä‘á»ƒ táº¡o káº¿t quáº£.";
                return;
            }

            try {
                const result = generateRandomResult(md5.toLowerCase());
                resultDiv.innerText = "âœ… Káº¿t quáº£: " + result;

                // Trá»« Ä‘iá»ƒm
                currentUser.points -= 1000;
                updateUserInfo(); // Cáº­p nháº­t thÃ´ng tin ngÆ°á»i dÃ¹ng sau má»—i láº§n dá»± Ä‘oÃ¡n

            } catch (e) {
                errorDiv.innerText = "âŒ Lá»—i: " + e.message;
            }
        }

        function handleRegister() {
            const username = document.getElementById('registerUsername').value.trim();
            const password = document.getElementById('registerPassword').value.trim();
            const registerResultDiv = document.getElementById('registerResult');

            if (!username || !password) {
                registerResultDiv.innerText = "âŒ Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ thÃ´ng tin.";
                return;
            }

            if (users.some(user => user.username === username)) {
                registerResultDiv.innerText = "âŒ TÃªn Ä‘Äƒng nháº­p Ä‘Ã£ tá»“n táº¡i.";
                return;
            }

            users.push({ username, password, points: 10000, isAdmin: false });
            registerResultDiv.innerText = "âœ… ÄÄƒng kÃ½ thÃ nh cÃ´ng! Báº¡n cÃ³ 10000 Ä‘iá»ƒm.";
        }

        function handleLogin() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            const loginResultDiv = document.getElementById('loginResult');

            // Kiá»ƒm tra cáº£ ngÆ°á»i dÃ¹ng bÃ¬nh thÆ°á»ng vÃ  admin
            const user = users.find(u => (u.username === username && u.password === password)) || 
                         (adminAccount.username === username && adminAccount.password === password && adminAccount);

            if (user) {
                currentUser = user.isAdmin ? adminAccount : user;
                loginResultDiv.innerText = "âœ… ÄÄƒng nháº­p thÃ nh cÃ´ng! Báº¡n cÃ³ " + (user.isAdmin ? "quyá»n quáº£n trá»‹." : user.points + " Ä‘iá»ƒm.");
                if (user.isAdmin) {
                    document.getElementById('adminSection').style.display = 'block';
                } else {
                    document.getElementById('adminSection').style.display = 'none';
                }
                updateUserInfo(); // Cáº­p nháº­t thÃ´ng tin ngÆ°á»i dÃ¹ng khi Ä‘Äƒng nháº­p
                document.getElementById('logoutButton').style.display = 'inline'; // Hiá»‡n nÃºt Ä‘Äƒng xuáº¥t
            } else {
                loginResultDiv.innerText = "âŒ TÃªn Ä‘Äƒng nháº­p hoáº·c máº­t kháº©u khÃ´ng Ä‘Ãºng.";
            }
        }

        function handleLogout() {
            currentUser = null;
            updateUserInfo(); // Cáº­p nháº­t thÃ´ng tin ngÆ°á»i dÃ¹ng
            document.getElementById('adminSection').style.display = 'none'; // áº¨n pháº§n quáº£n lÃ½ Ä‘iá»ƒm
            document.getElementById('logoutButton').style.display = 'none'; // áº¨n nÃºt Ä‘Äƒng xuáº¥t
            document.getElementById('loginResult').innerText = ""; // XÃ³a thÃ´ng bÃ¡o Ä‘Äƒng nháº­p
            document.getElementById('result').innerText = ""; // XÃ³a káº¿t quáº£ trÆ°á»›c Ä‘Ã³
            document.getElementById('error').innerText = ""; // XÃ³a lá»—i trÆ°á»›c Ä‘Ã³
        }

        function handleAddPoints() {
            const username = document.getElementById('adminUsername').value.trim();
            const pointsToAdd = parseInt(document.getElementById('pointsToAdd').value.trim());
            const adminResultDiv = document.getElementById('adminResult');

            if (!currentUser || !currentUser.isAdmin) {
                adminResultDiv.innerText = "âŒ Báº¡n chÆ°a Ä‘Äƒng nháº­p vá»›i quyá»n quáº£n trá»‹.";
                return;
            }

            if (!username || isNaN(pointsToAdd) || pointsToAdd <= 0) {
                adminResultDiv.innerText = "âŒ Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§ thÃ´ng tin.";
                return;
            }

            const user = users.find(u => u.username === username);
            if (user) {
                user.points += pointsToAdd;
                adminResultDiv.innerText = `âœ… ÄÃ£ cá»™ng ${pointsToAdd} Ä‘iá»ƒm cho ngÆ°á»i dÃ¹ng ${username}.`;
            } else {
                adminResultDiv.innerText = "âŒ NgÆ°á»i dÃ¹ng khÃ´ng tá»“n táº¡i.";
            }
        }
    </script>
</body>
</html>
