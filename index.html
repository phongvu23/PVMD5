<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>MD5 Kết Quả Ngẫu Nhiên</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 40px; background: #f2f2f2; }
        h1 { color: #333; }
        input, button { padding: 10px; font-size: 16px; }
        #result, #registerResult, #loginResult, #error { margin-top: 20px; font-weight: bold; }
        #result { color: green; }
        #error { color: red; }
    </style>
</head>
<body>
    <h1>🔐 Nhập chuỗi MD5 để tạo kết quả</h1>
    <input type="text" id="md5Input" placeholder="VD: c6a4afdb6725166ff1b5845c5546830d" size="40">
    <button onclick="handleGenerate()">Tạo kết quả</button>
    <div id="result"></div>
    <div id="error"></div>

    <h2>Đăng Ký</h2>
    <input type="text" id="registerUsername" placeholder="Tên đăng nhập" size="40">
    <input type="password" id="registerPassword" placeholder="Mật khẩu" size="40">
    <button onclick="handleRegister()">Đăng Ký</button>
    <div id="registerResult"></div>

    <h2>Đăng Nhập</h2>
    <input type="text" id="loginUsername" placeholder="Tên đăng nhập" size="40">
    <input type="password" id="loginPassword" placeholder="Mật khẩu" size="40">
    <button onclick="handleLogin()">Đăng Nhập</button>
    <div id="loginResult"></div>

    <script>
        let users = [];
        let currentUser = null;

        function generateRandomResult(md5Hash) {
            if (typeof md5Hash !== 'string' || md5Hash.length !== 32 || !/^[0-9a-f]{32}$/i.test(md5Hash)) {
                throw new Error("Mã MD5 không hợp lệ. Vui lòng nhập chuỗi MD5 gồm 32 ký tự hexa.");
            }

            let number = BigInt('0x' + md5Hash);
            let num1 = Number((number % 6n) + 1n);
            number = (number * 3n + 7n) % 10000000000n;
            let num2 = Number((number % 6n) + 1n);
            number = ((number - 5n) * 2n) % 10000000000n;
            let num3 = Number((number % 6n) + 1n);

            const mapping = { 1: '3', 2: '2', 3: '1', 4: '5', 5: '6', 6: '4' };

            let mappedNum1 = mapping[num1];
            let mappedNum2 = mapping[num2];
            let mappedNum3 = mapping[num3];

            const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+-=[]{}|;:',.<>/?";
            let randomStr = "";
            for (let i = 0; i < 30; i++) {
                randomStr += chars.charAt(Math.floor(Math.random() * chars.length));
            }

            return `${mappedNum1}-${mappedNum2}-${mappedNum3}|${randomStr}`;
        }

        function handleGenerate() {
            const md5 = document.getElementById('md5Input').value.trim();
            const resultDiv = document.getElementById('result');
            const errorDiv = document.getElementById('error');
            resultDiv.innerText = '';
            errorDiv.innerText = '';

            if (!currentUser) {
                errorDiv.innerText = "❌ Bạn cần đăng nhập để tạo kết quả.";
                return;
            }

            if (currentUser.points < 1000) {
                errorDiv.innerText = "❌ Bạn không đủ điểm để tạo kết quả.";
                return;
            }

            try {
                const result = generateRandomResult(md5.toLowerCase());
                resultDiv.innerText = "✅ Kết quả: " + result;

                // Trừ điểm
                currentUser.points -= 1000;

            } catch (e) {
                errorDiv.innerText = "❌ Lỗi: " + e.message;
            }
        }

        function handleRegister() {
            const username = document.getElementById('registerUsername').value.trim();
            const password = document.getElementById('registerPassword').value.trim();
            const registerResultDiv = document.getElementById('registerResult');

            if (!username || !password) {
                registerResultDiv.innerText = "❌ Vui lòng nhập đầy đủ thông tin.";
                return;
            }

            if (users.some(user => user.username === username)) {
                registerResultDiv.innerText = "❌ Tên đăng nhập đã tồn tại.";
                return;
            }

            users.push({ username, password, points: 10000 });
            registerResultDiv.innerText = "✅ Đăng ký thành công! Bạn có 10000 điểm.";
        }

        function handleLogin() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            const loginResultDiv = document.getElementById('loginResult');

            const user = users.find(u => u.username === username && u.password === password);

            if (user) {
                currentUser = user;
                loginResultDiv.innerText = "✅ Đăng nhập thành công! Bạn có " + user.points + " điểm.";
            } else {
                loginResultDiv.innerText = "❌ Tên đăng nhập hoặc mật khẩu không đúng.";
            }
        }
    </script>
</body>
</html>
